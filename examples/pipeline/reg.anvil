chan reg_in = {
    left req : (logic@#1) @dyn-@dyn
}

chan reg_out = {
    left res : (logic@#1) @dyn-@dyn
}

proc register (in_p : left reg_in, out_p : right reg_out) =
    reg r : logic
    loop {
        let r_val = recv in_p.req in
        r_val =>
        set r := r_val =>
        send out_p.res (*r)
    }
